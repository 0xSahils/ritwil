# Prisma – schema and migrations

## Source of truth

- **`schema.prisma`** – Single source of truth. Edit only this file.
- **`src/generated/client/`** – Generated by `npx prisma generate`. Do not edit.

## Connecting to a new database

1. Set **`DATABASE_URL`** in `Backend/.env`.
2. From project root: **`npm run setup`** (installs deps, runs `prisma generate` + `prisma db push`).
3. Schema is applied; no manual SQL needed.

Optional: **`npm run db:seed`** to seed data (note: seed script may reference legacy models; run only if updated for current schema).

## Migrations folder

- **Timestamped folders** (e.g. `20260118204808_init/`, `20260218100000_add_vbid_unique/`) – Used by `prisma migrate deploy` / `prisma migrate dev`. Each contains `migration.sql`.
- **Loose `.sql` files** (`9999_*.sql`, `10000_*.sql`, `10001_*.sql`) – Legacy custom SQL. **Not run by Prisma.** For a new DB, `db push` applies the current schema; these files are kept for reference only and can be removed if desired.

## VBID

- **EmployeeProfile.vbid** has a **unique** constraint: at most one profile per non-null VBID (multiple NULLs allowed).
- **User.vbid** is denormalized from the profile; canonical value is on EmployeeProfile.

## Removed / redundant

- **`src/generated/client_old/`** – Removed; it was an old duplicate of the generated client. App uses only `src/generated/client/`.
